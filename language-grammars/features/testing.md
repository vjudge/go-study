# 测试程序


### Go 程序三类测试
* 功能测试（test）
* 基准测试（benchmark，性能测试）
* 示例测试（example）



### 测试源码文件
* 源码文件必须以 _test 结尾，如 XXX_test.go
* 每个测试源码文件都必须至少包含一个测试函数
* 每个测试源码文件中，都可以包含用来做任何一类测试的测试函数



### 测试函数
* 功能测试函数：测试函数名称必须以 Test 开头，并且唯一参数类型必须是 *testing.T 类型。如 func TestXxx (t *testing.T) { ... }
* 性能测试函数：测试函数名称必须以 Benchmark 开头，并且唯一参数的类型必须是 *testing.B 类型
* 示例参数函数：测试函数名称必须以 Example 开头，但函数的参数列表没有强制规定
* TestMain: 在测试函数执行之前调用。其唯一参数的类型必须是 *testing.M 类型



### 断言日志

#### t.Log()
输出信息

#### t.Logf()
输出格式化的信息

#### t.Fail()
测试失败，测试继续，也就是之后的代码依然会执行

#### t.Error()
断言失败的时候，标识测试失败，并打印出必要的信息，但是测试继续。相当于 Log + Fail

#### t.Errorf()
失败的同时，打印失败测试日志，相当于 Logf + Fail

#### t.FailNow()
测试失败，测试中断

#### t.Fatal()
断言失败的时候，标识测试失败，打印出必要的信息，但中断测试。相当于 Log + FailNow

#### t.Fatalf()
断言失败的时候，标识测试失败，打印出必要的信息，但中断测试。相当于 Logf + FailNow

#### t.SkipNow()
跳过测试，测试中断

#### t.Skip()
跳过这个测试，并且打印出信息，相当于 Log + SkipNow

#### t.Skipf()
跳过这个测试，并且打印出信息，相当于 Logf + SkipNow

#### t.Parallel()
当前测试只会与其他带有 Parallel 方法的测试并行进行测试



### 功能测试: go test
* go test 命令开始运行时，会做一些准备工作
  * 会读取-cpu标记的值，并把它转换为一个以int为元素类型的切片（逻辑 CPU 切片）。如果没有追加该标记，就是当前计算机 CPU 核心的实际数量
* 准备工作顺利完成后，go test 命令就会针对每个被测代码包，依次进行构建、执行包中符合要求的测试函数，清理临时文件，打印测试结果
* 为了加快测试速度，通常会并发地对多个被测代码包进行功能测试，但是在最后打印测试结果的时候，它会依照我们给定的顺序逐个进行，感觉到它是在完全串行地执行测试流程
```shell
# 如果成功，不会打印测试日志
go test vjudge/sample
# 无论是否成功，够可以打印测试日志
go test -v vjudge/sample
```



### 性能测试: go test -bench=.
* -bench=.：标记的值 . 表明需要执行任意名称的性能测试函数
* -run=^$：标记用于表明需要执行哪些功能测试函数，以函数名称为依据的
  * 标记的值^$意味着：只执行名称为空的功能测试函数，换句话说，不执行任何功能测试函数
  * 如果不加 -run 标记，就会执行被测代码包中的所有功能测试函数
* -cpu=2,4,8：值是一个正整数的列表，设置最大 P 数量的列表。最大 P 数量相当于可以同时运行 goroutine 的逻辑 CPU 的最大个数
  * 在默认情况下，最大 P 数量就等于当前计算机 CPU 核心的实际数量
* -count：标记是专门用于重复执行测试函数的。它的值必须大于或等于0，并且默认值为1
  * 性能测试函数的执行次数 = `-cpu`标记的值中正整数的个数 x `-count`标记的值 x 探索式执行中测试函数的实际执行次数
  * 功能测试函数的执行次数 = `-cpu`标记的值中正整数的个数 x `-count`标记的值
* -parallel：设置同一个被测代码包中的功能测试函数的最大并发执行数。该标记的默认值是测试运行时的最大 P 数量
```shell
go test -bench=. -run=^$ vjudge/sample
```
go test命令每一次对性能测试函数的执行，都是一个探索的过程。它会在测试函数的执行时间上限不变的前提下，尝试找到被测程序的最大执行次数



### 缓存
对于失败的测试结果，go test 不会进行缓存。每次测试都会产生全新的结果
```shell
# 删除所有测试结果缓存
go clean -testcache
```



